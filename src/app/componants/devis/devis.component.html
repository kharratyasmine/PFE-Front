<div class="container mt-4">
  <div class="mb-3 d-flex justify-content-between align-items-center">
    <h5>{{ 'Technical and Financial Proposal Project' | translate }}</h5>
    <div class="d-flex align-items-center">
      <label class="me-2">{{ 'Items per page' | translate }}:</label>
      <select class="form-select form-select-sm" style="width: auto" [(ngModel)]="itemsPerPage" (change)="onItemsPerPageChange()">
        <option [value]="3">3</option>
        <option [value]="5">5</option>
        <option [value]="10">10</option>
        <option [value]="20">20</option>
        <option [value]="50">50</option>
      </select>
    </div>
  </div>

  <table class="table table-bordered table-hover text-center shadow-sm">
    <thead>
      <tr>
        <th>{{ 'ID' | translate }}</th>
        <th>{{ 'reference' | translate }}</th>
        <th>{{ 'Date de cr√©ation' | translate }}</th>
        <th>{{ 'actions' | translate }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let devis of devisList | paginate: { itemsPerPage: itemsPerPage, currentPage: currentPage }">
        <td>{{ devis.id }}</td>
        <td>
          <div class="d-flex align-items-center">
            <span class="status-indicator me-2" [ngClass]="{
              'bg-success': devis.status === 'ACCEPTED',
              'bg-warning': devis.status === 'PENDING',
              'bg-danger': devis.status === 'REJECTED',
              'bg-info': devis.status === 'DRAFT'
            }"></span>
            {{ devis.reference }}
          </div>
        </td>
        <td>
          <div class="d-flex align-items-center">
            <span class="date-indicator me-2" [ngClass]="{
              'bg-danger': isOverdue(devis.creationDate),
              'bg-warning': isNearDeadline(devis.creationDate),
              'bg-success': !isOverdue(devis.creationDate) && !isNearDeadline(devis.creationDate)
            }"></span>
            {{ devis.creationDate | date }}
          </div>
        </td>
        <td>
          <!-- Button to view Devis --> 
          <button class="btn btn-outline-secondary btn-sm me-2" (click)="openDevisDetailsModal(devis.id!)">
            <i class="fas fa-eye"></i>
          </button>

          <!-- Button to edit Devis -->
          <button class="btn btn-outline-success btn-sm me-2" (click)="editDevis(devis)">
            <i class="fas fa-pencil-alt"></i>
          </button>

          <!-- Button to delete Devis -->
          <button class="btn btn-outline-danger btn-sm me-2" (click)="deleteDevis(devis.id!)">
            <i class="fas fa-trash-alt"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Pagination -->
  <div class="d-flex justify-content-between align-items-center mt-3 mb-4">
    <div class="text-muted">
      {{ 'Showing' | translate }} {{ (currentPage - 1) * itemsPerPage + 1 }} - {{ Math.min(currentPage * itemsPerPage, devisList.length) }} {{ 'of' | translate }} {{ devisList.length }} {{ 'items' | translate }}
    </div>
    <pagination-controls 
      (pageChange)="onPageChange($event)" 
      [autoHide]="false"
      [maxSize]="5"
      [directionLinks]="true"
      previousLabel="¬´ {{ 'Previous' | translate }}"
      nextLabel="{{ 'Next' | translate }} ¬ª">
    </pagination-controls>
  </div>
</div>

<div class="modal fade show d-block" tabindex="-1" role="dialog" *ngIf="isModalEditOpen"
  style="background-color: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">‚úèÔ∏è Modifier le Devis</h5>
        <button type="button" class="btn-close" (click)="closeEditModal()"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label>{{ 'reference' | translate }}</label>
            <input type="text" [(ngModel)]="selectedDevis!.reference" name="reference" class="form-control" />
          </div>
          <div class="mb-3">
            <label>√âdition</label>
            <input type="text" [(ngModel)]="selectedDevis!.edition" name="edition" class="form-control" />
          </div>
          <div class="mb-3">
            <label>Date de cr√©ation</label>
            <input type="date" [(ngModel)]="selectedDevis!.creationDate" name="creationDate" class="form-control" />
          </div>
          <div class="mb-3">
            <label>Statut</label>
            <input type="text" [(ngModel)]="selectedDevis!.status" name="status" class="form-control" />
          </div>
          <div class="mb-3">
            <label>Validit√© de la proposition</label>
            <input type="text" [(ngModel)]="selectedDevis!.proposalValidity" name="proposalValidity"
              class="form-control" />
          </div>
          <div class="mb-3">
            <label>Auteur</label>
            <input type="text" [(ngModel)]="selectedDevis!.author" name="author" class="form-control" />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeEditModal()">Annuler</button>
        <button class="btn btn-primary" (click)="saveEditedDevis()">üíæ Enregistrer</button>
      </div>
    </div>
  </div>
</div>

<style>
.status-indicator, .date-indicator {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  display: inline-block;
}

.bg-success {
  background-color: #28a745;
}

.bg-warning {
  background-color: #ffc107;
}

.bg-danger {
  background-color: #dc3545;
}

.bg-info {
  background-color: #17a2b8;
}
</style>