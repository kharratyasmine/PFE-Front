<div class="container my-4">
  <h3 class="text-center mb-4">Rapport Hebdomadaire - {{ selectedMonth }} {{ selectedYear }}</h3>

  <!-- Loading state -->
  <div *ngIf="loading" class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Chargement des donn√©es...</p>
  </div>

  <!-- Error state -->
  <div *ngIf="error" class="alert alert-danger my-5" role="alert">
    {{ error }}
  </div>

  <!-- Content -->
  <div *ngIf="!loading && !error">

    <!-- Monthly Workload By Project / Module Table (Full Width) -->
    <div class="card mb-4">
      <div class="card-header"><h4>Monthly Workload By Project / Module</h4></div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-bordered table-striped table-sm">
            <thead>
              <tr>
                <th>Month</th>
                <th>Project Name</th>
                <th>Working Days (MD)</th>
                <th>Estimated Days (MD)</th>
                <th>Effort Variance</th>
              </tr>
            </thead>
            <tbody>
              <ng-container *ngIf="monthlyWorkloadData.length > 0">
                <tr *ngFor="let item of monthlyWorkloadData; let i = index">
                  <td *ngIf="i === 0" [attr.rowspan]="monthlyWorkloadData.length">{{ item.month }}</td>
                  <td>{{ item.projectName }}</td>
                  <td>{{ item.workingDays | number:'1.0-2' }}</td>
                  <td>{{ item.estimatedDays | number:'1.0-2' }}</td>
                  <td [ngClass]="{'text-danger': item.effortVariance < 0, 'text-success': item.effortVariance >= 0}">{{ item.effortVariance | number:'1.0-2' }}%</td>
                </tr>
              </ng-container>
               <ng-container *ngIf="monthlyWorkloadData.length === 0">
                 <tr>
                   <td colspan="5" class="text-center text-muted">No monthly workload data available for the selected period</td>
                 </tr>
               </ng-container>
              <tr class="table-primary">
                <td colspan="2"><strong>Totals</strong></td>
                <td><strong>{{ monthlyWorkloadTotals.workingDays | number:'1.0-2' }}</strong></td>
                <td><strong>{{ monthlyWorkloadTotals.estimatedDays | number:'1.0-2' }}</strong></td>
                <td [ngClass]="{'text-danger': monthlyWorkloadTotals.effortVariance < 0, 'text-success': monthlyWorkloadTotals.effortVariance >= 0}"><strong>{{ monthlyWorkloadTotals.effortVariance | number:'1.0-2' }}%</strong></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Weekly Workload By Project / Module Bar Chart (Full Width) -->
    <div class="card mb-4">
       <div class="card-header"><h4>Weekly Workload By Project / Module</h4></div>
        <div class="card-body">
          <ng-container *ngIf="weeklyWorkloadChartData.labels!.length > 0">
            <canvas baseChart
                    [data]="weeklyWorkloadChartData"
                    [options]="chartOptions"
                    [type]="'bar'">
            </canvas>
          </ng-container>
           <div *ngIf="weeklyWorkloadChartData.labels!.length === 0" class="text-center text-muted my-4">
            No weekly workload data available for the selected period
          </div>
        </div>
    </div>

    <div class="row">
      <!-- Weekly Effort Variance Table -->
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-header"><h4>Effort Variance (Weekly)</h4></div>
          <div class="card-body">
              <div class="table-responsive">
                  <table class="table table-bordered table-striped table-sm">
                      <thead>
                        <tr>
                          <th>Week</th>
                          <th *ngFor="let item of weeklyEffortVarianceData">{{ item.week }}</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>Weekly Effort Variance</td>
                          <td *ngFor="let item of weeklyEffortVarianceData" [ngClass]="{'text-danger': item.effortVariance < 0, 'text-success': item.effortVariance >= 0}">{{ item.effortVariance | number:'1.0-2' }}%</td>
                        </tr>
                       <tr *ngIf="weeklyEffortVarianceData.length === 0">
                          <td [attr.colspan]="weeks.length + 1" class="text-center text-muted">No weekly effort variance data available for the selected period</td>
                        </tr>
                      </tbody>
                    </table>
              </div>
          </div>
        </div>
      </div>
       <!-- Weekly Effort Variance Line Chart -->
      <div class="col-md-6">
        <div class="card mb-4">
             <div class="card-header"><h4>Weekly Effort Variance Chart</h4></div>
             <div class="card-body">
                <ng-container *ngIf="weeklyEffortVarianceChartData.labels!.length > 0">
                    <canvas baseChart
                            [data]="weeklyEffortVarianceChartData"
                            [options]="chartOptions"
                            [type]="'line'">
                    </canvas>
                </ng-container>
                <div *ngIf="weeklyEffortVarianceChartData.labels!.length === 0" class="text-center text-muted my-4">
                    No weekly effort variance data available for the selected period
                </div>
             </div>
        </div>
      </div>
    </div>

    <div class="row">
         <!-- Monthly Consolidated Effort Variance Table -->
        <div class="col-md-6">
             <div class="card mb-4">
                <div class="card-header"> <h4>Monthly Consolidated Effort Variance</h4></div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped table-sm">
                          <thead>
                            <tr>
                              <th>Month</th>
                              <th *ngFor="let item of monthlyConsolidatedEffortVarianceData">{{ item.month }}</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>Consolidated Effort Variance</td>
                              <td *ngFor="let item of monthlyConsolidatedEffortVarianceData" [ngClass]="{'text-danger': item.effortVariance < 0, 'text-success': item.effortVariance >= 0}">{{ item.effortVariance | number:'1.0-2' }}%</td>
                            </tr>
                            <tr *ngIf="monthlyConsolidatedEffortVarianceData.length === 0">
                                <td colspan="2" class="text-center text-muted">No monthly consolidated effort variance data available</td>
                            </tr>
                          </tbody>
                        </table>
                    </div>
                </div>
             </div>
        </div>
        <!-- Monthly Consolidated Effort Variance Line Chart -->
        <div class="col-md-6">
             <div class="card mb-4">
                <div class="card-header"><h4>Monthly Consolidated Effort Variance Chart</h4></div>
                <div class="card-body">
                     <ng-container *ngIf="monthlyConsolidatedEffortVarianceChartData.labels!.length > 0">
                        <canvas baseChart
                                [data]="monthlyConsolidatedEffortVarianceChartData"
                                [options]="chartOptions"
                                [type]="'line'">
                        </canvas>
                    </ng-container>
                    <div *ngIf="monthlyConsolidatedEffortVarianceChartData.labels!.length === 0" class="text-center text-muted my-4">
                        No monthly consolidated effort variance data available for the selected period
                    </div>
                </div>
            </div>
        </div>
    </div>

  </div>
</div>
