<div class="mb-3 d-flex justify-content-between align-items-center">
  <h5>{{ 'teams associated with the project' | translate }}</h5>
</div>

<div *ngIf="teams.length > 0; else noTeams">
  <div *ngFor="let team of teams" class="card mb-3 shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center bg-light">
      <div class="d-flex align-items-center gap-2">
        <i class="fas fa-users text-primary"></i>
        <h5 class="mb-0">{{ team.name }}</h5>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-success btn-sm" (click)="openAddMemberModal(team)">
          <i class="fas fa-user-plus"></i> {{ 'add member' | translate }}
        </button>
        <button class="btn btn-outline-danger btn-sm" (click)="removeTeam(team.id)">
          <i class="fas fa-trash-alt"></i>
        </button>
      </div>
    </div>

    <div class="card-body p-3">
      <ul class="list-group">
        <li *ngFor="let member of team.members" class="list-group-item d-flex justify-content-between align-items-center">
          <div class="w-100">
            <strong>{{ member.name }}</strong> ({{ member.jobTitle }})<br />
            <small>
              🎓 {{ member.role }} | 💰 {{ member.cost }} TND<br />
              🕒 {{ 'allocation' | translate }} :
              <span class="fw-bold">{{ member.allocation! * 100 | number:'1.0-0' }}%</span>
              <button class="btn btn-outline-primary btn-sm ms-2" (click)="openAllocationModal(member)">
                ✏️ {{ 'edit' | translate }}
              </button>
            </small>
          </div>
          <div class="d-flex align-items-center gap-2">
            <span class="badge bg-secondary">{{ member.initial }}</span>
            <button class="btn btn-sm btn-danger" (click)="removeMemberFromTeam(team.id, member.id!)">
              <i class="fas fa-user-minus"></i>
            </button>
          </div>
        </li>
      </ul>
    </div>
  </div>
</div>

<ng-template #noTeams>
  <div class="alert alert-warning">{{ 'no team found' | translate }}</div>
</ng-template>

<!-- Modal Allocation -->
<div class="modal fade" id="allocationModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ "edit allocation" | translate }}</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <label>{{ 'new allocation' | translate }} (%)</label>
        <input type="number" [(ngModel)]="selectedAllocation" min="0" max="100" class="form-control" />
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">{{ 'cancel' | translate }}</button>
        <button class="btn btn-primary" (click)="saveAllocation()">{{ 'save' | translate }}</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Ajouter un membre -->
<div class="modal fade" id="addMemberModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ 'add member to team' | translate }}</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <label>{{ 'select member' | translate }}</label>
        <select class="form-select" [(ngModel)]="selectedMemberIdToAdd">
          <option *ngFor="let member of availableMembers" [value]="member.id">
            {{ member.name }}
          </option>
        </select>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">{{ 'cancel' | translate }}</button>
        <button class="btn btn-primary" (click)="addMemberToTeam()">{{ 'add' | translate }}</button>
      </div>
    </div>
  </div>
</div>
