<div class="d-flex justify-content-end align-items-center mb-3 gap-2">
  <!-- Champ de date caché mais actif -->
  <mat-form-field appearance="outline" style="opacity: 0; height: 0; pointer-events: none;">
    <input matInput [matDatepicker]="picker" [(ngModel)]="selectedDate">
    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-datepicker #picker></mat-datepicker>
  </mat-form-field>

  <!-- Bouton calendrier -->
  <button class="btn btn-outline-success btn-sm" (click)="picker.open()">
    <i class="fas fa-calendar"></i>
  </button>

  <!-- Bouton Ajouter Planification -->
  <button class="btn btn-outline-success btn-sm" (click)="openModal()">
    <i class="fas fa-plus"></i> Ajouter Planification
  </button>
</div>

  <div class="row" *ngFor="let q of [1, 2, 3, 4]">
    <div class="col-12 mb-4">
      <div class="card shadow">
        <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
          <strong>Q{{ q }} Year</strong>
        </div>
        <div class="card-body p-0">
          <table class="table table-bordered text-center m-0">
            <thead class="table-light">
              <tr>
                <th>Month</th>
                <th>Estimated workload<br>per Resource (Man/day)</th>
                <th>Number of resources</th>
                <th>Estimated total workload<br>(Man/day)</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let w of getByQuarter(q)">
                <td><strong>{{ w.month }}</strong></td>
                <td>{{ w.estimatedWorkloadPerResource }}</td>
                <td>{{ w.numberOfResources }}</td>
                <td>{{ w.totalEstimatedWorkload }}</td>
                <td>
                  <button class="btn btn-outline-success btn-sm" (click)="openModal(w)">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-outline-danger btn-sm" (click)="confirmDelete(w.id!)">
                    <i class="fas fa-trash"></i>
                  </button>
                </td>
              </tr>
              <tr class="table-info fw-bold">
                <td colspan="3">Total Q{{ q }} Year (Man/day)</td>
                <td colspan="2">{{ totalQuarter(q) }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade show d-block" tabindex="-1" role="dialog" *ngIf="showModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ editing ? 'Modifier' : 'Ajouter' }} Planification</h5>
          <button type="button" class="btn-close" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label>Mois</label>
              <select class="form-control" [(ngModel)]="currentWorkload.month" name="month" (change)="onMonthOrYearChange()">
                <option value="" disabled>-- Sélectionnez un mois --</option>
                <option *ngFor="let m of months" [value]="m">{{ m }}</option>
              </select>
            </div>
            <div class="mb-3">
              <label>Année</label>
              <input type="number" class="form-control" [(ngModel)]="currentWorkload.year" name="year" (input)="onMonthOrYearChange()">
            </div>
            <div class="mb-3">
              <label>Charge estimée par ressource (modifiable)</label>
              <input type="number" class="form-control" [(ngModel)]="currentWorkload.estimatedWorkloadPerResource" name="workload" (input)="updateTotal()">
            </div>
            <div class="mb-3">
              <label>Nombre de ressources</label>
              <input type="number" class="form-control" [(ngModel)]="currentWorkload.numberOfResources" name="resources" (input)="updateTotal()">
            </div>
            <div class="mb-3">
              <label>Charge totale estimée</label>
              <input type="number" class="form-control" [(ngModel)]="currentWorkload.totalEstimatedWorkload" name="total" (input)="updateTotal()">
            </div>
            <div *ngIf="holidaysInMonth.length > 0" class="alert alert-info">
              <strong>Jours fériés détectés :</strong>
              <ul class="mb-0">
                <li *ngFor="let h of holidaysInMonth">{{ h }}</li>
              </ul>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeModal()">Annuler</button>
          <button class="btn btn-primary" (click)="save()">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

