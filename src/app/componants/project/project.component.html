<div class="container">
  <h2 class="text-center mt-3">üìå {{ 'Project List' | translate }}</h2>

  <!-- üîó Fil d‚ÄôAriane -->
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb bg-light p-2 rounded shadow-sm">
      <li class="breadcrumb-item">
        <a routerLink="/Dashboard">üè† {{ 'DASHBOARD' | translate }}</a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        {{ 'Project List' | translate }}
      </li>
    </ol>
  </nav>

  <!-- üîç Barre de recherche et actions -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <input type="text" (input)="searchProject($event)" placeholder="üîç {{ 'Search Project' | translate }}"
      class="form-control" style="width: 250px;" />
    <div>
      <button class="btn btn-outline-primary me-2" (click)="downloadExcel()">
        <i class="fas fa-download"></i>
      </button>
      <button class="btn btn-outline-success" (click)="openModal()"> <i class="fas fa-plus"></i> {{ 'Add Project' | translate }}</button>
    </div>
  </div>

  <!-- üìã Tableau -->
  <table class="table table-bordered table-hover text-center shadow-sm">
    <thead>
      <tr>
        <th>{{ 'Project Name' | translate }}</th>
        <th>{{ 'DESCRIPTION' | translate }}</th>
        <th>{{ 'Project Type' | translate }}</th>
        <th>{{ 'Start_Date' | translate }}</th>
        <th>{{ 'End Date' | translate }}</th>
        <th>{{ 'STATUS' | translate }}</th>
        <th>{{ 'CLIENT' | translate }}</th>
        <th>{{ 'ACTIVITY' | translate }}</th>
        <th>{{ 'TECHNOLOGIES' | translate }}</th>
        <th>{{ 'ACTIONS' | translate }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let project of filteredProjects | paginate: { itemsPerPage: itemsPerPage, currentPage: currentPage }">
        <td>{{ project?.name }}</td>
        <td>{{ project?.description }}</td>
        <td>{{ project?.projectType }}</td>
        <td>{{ project?.startDate | date: 'yyyy-MM-dd' }}</td>
        <td>{{ project?.endDate | date: 'yyyy-MM-dd' }}</td>
        <td>{{ getStatusLabel(project.status) }}</td>
        
        <td>
          <div *ngFor="let name of project.client?.salesManagers" class="d-block mb-1">
            {{ name || ('NO_CLIENT' | translate)}}
          </div>
        </td>
        <td>{{ project?.activity }}</td>
        <td>{{ project?.technologie }}</td>
        <td>
          <a [routerLink]="['/project', project.id]" class="btn btn-outline-secondary btn-sm me-2">
            <i class="fas fa-eye"></i>
          </a>
          <button class="btn btn-outline-success btn-sm me-2" (click)="openModal(project)">
            <i class="fas fa-pencil-alt"></i>
          </button>
          <button class="btn btn-outline-danger btn-sm" (click)="deleteProject(project.id!)">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <pagination-controls (pageChange)="currentPage = $event"></pagination-controls>

  <!-- üì¶ Modal Bootstrap -->
  <dialog id="projectModal">
    <div class="dialog-header">
      <span>{{ selectedProject.id ? ('edit project' | translate) : ('add project' | translate) }}</span>
      <button class="close-btn" (click)="closeModal()">&times;</button>
    </div>
  
    <div class="dialog-body">
  
      <label>{{ 'project name' | translate }}</label>
      <input class="form-control" type="text" [(ngModel)]="selectedProject.name" name="name" required />
  
      <label>{{ 'description' | translate }}</label>
      <textarea class="form-control" [(ngModel)]="selectedProject.description" name="description" required></textarea>
  
      <label>{{ 'project type' | translate }}</label>
      <input class="form-control" type="text" [(ngModel)]="selectedProject.projectType" name="projectType" required />
  
      <label>{{ 'start date' | translate }}</label>
      <input class="form-control" type="date" [(ngModel)]="selectedProject.startDate" name="startDate" required />
  
      <label>{{ 'end date' | translate }}</label>
      <input class="form-control" type="date" [(ngModel)]="selectedProject.endDate" name="endDate" required />
  
      <label>{{ 'status' | translate }}</label>
      <select class="form-select" [(ngModel)]="selectedProject.status" name="status">
        <option *ngFor="let s of statusList" [ngValue]="s">{{ getStatusLabel(s) }}</option>
      </select>
  
      <label>{{ 'client' | translate }}</label>
      <select class="form-select" [(ngModel)]="selectedProject.clientId" name="clientId">
        <option [ngValue]="null">-- {{ 'select client' | translate }} --</option>
        <option *ngFor="let client of clients" [value]="client.id">
          {{ client.salesManagers }} - {{ client.company }}
        </option>
      </select>
  
      <label>{{ 'user' | translate }}</label>
      <select class="form-select" [(ngModel)]="selectedProject.userId" name="userId">
        <option [ngValue]="null">-- {{ 'select user' | translate }} --</option>
        <option *ngFor="let user of users" [value]="user.id">
          {{ user.firstname }} {{ user.lastname }}
        </option>
      </select>
  
      <label>{{ 'activity' | translate }}</label>
      <input class="form-control" type="text" [(ngModel)]="selectedProject.activity" name="activity" />
  
      <label>{{ 'technologies' | translate }}</label>
      <input class="form-control" type="text" [(ngModel)]="selectedProject.technologie" name="technologie" />
    </div>
  
    <div class="dialog-footer">
      <button class="btn btn-secondary" (click)="closeModal()">‚ùå {{ 'cancel' | translate }}</button>
      <button class="btn btn-primary" (click)="saveProject()">‚úÖ {{ 'save' | translate }}</button>
    </div>
  </dialog>
  
</div>
